- __id:
    - 1
    - 100
  name: catalog.wiki
  URL: http://127.0.0.1:3000
  path_internal: /$
  routes:
    =:
      - - $
        - "@":
            - 8
            - 101
      - - apps
        - "@":
            - 5
            - 103
      - - site
        - "@":
            - 5
            - 104
      - - system
        - "@":
            - 5
            - 13
      - - null
        - "@":
            - 5
            - 106
      - - null
        - "@":
            - 9
            - 101
    "@": Catalog
  __category__:
    "@":
      - 0
      - 1
  "@": Data
- __id:
    - 3
    - 101
  content: export let print = console.log
  __category__:
    "@":
      - 0
      - 3
  "@": Data
- __id:
    - 3
    - 102
  content: |-
    import {print} from '../site/utils.js'
    export function check() { print('called widgets.js:check()') } 
    //let fs = await importLocal('fs')
    //print('fs:',fs)
  __category__:
    "@":
      - 0
      - 3
  "@": Data
- __id:
    - 5
    - 102
  name: /demo
  __category__:
    "@":
      - 0
      - 5
  "@": Data
- __id:
    - 5
    - 103
  name: /apps
  files:
    demo:
      "@":
        - 5
        - 102
    paperity:
      "@":
        - 5
        - 107
    "@": Catalog
  __category__:
    "@":
      - 0
      - 5
  "@": Data
- __id:
    - 5
    - 104
  name: /site
  files:
    utils.js:
      "@":
        - 3
        - 101
    widgets.js:
      "@":
        - 3
        - 102
    "@": Catalog
  __category__:
    "@":
      - 0
      - 5
  "@": Data
- __id:
    - 8
    - 101
  name: /$
  __category__:
    "@":
      - 0
      - 8
  "@": Data
- __id:
    - 9
    - 101
  name: Catalog
  spaces:
    sys.category:
      "@":
        - 0
        - 0
    sys.site:
      "@":
        - 0
        - 1
    sys.dir:
      "@":
        - 0
        - 5
    sys.file:
      "@":
        - 0
        - 3
    "@": Catalog
  __category__:
    "@":
      - 0
      - 9
  "@": Data
- __id:
    - 0
    - 100
  name: Varia
  info: Category of items that do not belong to any specific category.
  class_body: >-
    static check() { import('/system/local/utils.js').then(mod =>
    console.log("Varia.code: imported ", mod)) }

    static error() { throw new Error('Varia/code/error()') }
  fields:
    title:
      "@": STRING
    "@": Catalog
  __category__:
    "@":
      - 0
      - 0
  "@": Data
- __id:
    - 100
    - 101
  title: Ala ma kota Sierściucha i psa Kłapoucha.
  __category__:
    "@":
      - 0
      - 100
  "@": Data
- __id:
    - 100
    - 102
  title: ąłęÓŁŻŹŚ
  __category__:
    "@":
      - 0
      - 100
  "@": Data
- __id:
    - 5
    - 106
  name: domain
  info: Folder with public static files that must be accessible at the domain
    root, like .../favicon.ico, /robots.txt etc.
  files:
    favicon.ico:
      "@":
        - 4
        - 100
    "@": Catalog
  __category__:
    "@":
      - 0
      - 5
  "@": Data
- __id:
    - 0
    - 200
  name: TwitterPost
  fields:
    text:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    "@": Catalog
  class_init: |
    // DRAFT...
    // import {print} from '/site/utils.js'
    // console.log('print:', print)
    // console.log('TwitterPost/code executed')

    // import {check} from '/site/widgets.js'
    // import {Item} from '/system/local/item.js'
    // import vm from 'vm'
    // check()
    // console.log('registry:', registry)
    // console.log('Item:', Item)
    // console.log('vm:', vm)
  views:
    view: |
      let text = this.prop('text')
      return P('Post:', BR(), text)
    "@": Catalog
  class_body: |-
    // FOR RECORD ONLY...
    // this method works OK (no await import)
    init_OK() {
        console.log('this.utils #1: started...')
        return import('/site/utils.js').then(utils => {
            this.utils = utils
            console.log('this.utils #1:', this.utils)
        })
    }
    // this method works WRONG: the web request is being completed while 
    // the method waits on await import below (!?)
    async init_ERR() {
        console.log('this.utils #1: started...')
        let utils = await import('/site/utils.js')
        this.utils = utils
        console.log('this.utils #1:', this.utils)
    }
  __category__:
    "@":
      - 0
      - 0
  "@": Data
- __id:
    - 4
    - 100
  name: favicon.ico
  path: /home/marcin/Documents/priv/catalog/src/schemat/assets/favicon.ico
  __category__:
    "@":
      - 0
      - 4
  "@": Data
- __id:
    - 51
    - 100
  name: mysql-paperity
  info: |
    Connects through ssh tunneling. Must launch this in console beforehand:
    autossh -p 55522 -f paperity@srv.paperity.org -L 3307:127.0.0.1:3306 -N
  host: localhost
  port: "3307"
  user: paperity
  database: paperity
  password: pe45n1bc
  tables:
    /apps/paperity/Journal: pap_journals
    /apps/paperity/Paper: pap_papers_view
    "@": Catalog
  readonly: true
  __category__:
    "@":
      - 0
      - 51
  "@": Data
- __id:
    - 200
    - 100
  name: Post A
  text: Ala ma kota
  __category__:
    "@":
      - 0
      - 200
  "@": Data
- __id:
    - 5
    - 107
  name: /paperity
  files:
    Journal:
      "@":
        - 0
        - 201
    Paper:
      "@":
        - 0
        - 202
    "@": Catalog
  __category__:
    "@":
      - 0
      - 5
  "@": Data
- __id:
    - 0
    - 201
  name: Journal
  info: Paperity's Journal object.
  fields:
    pid:
      =:
        - - 10
          - 3
        - {}
      "@": SchemaWrapper
    title:
      "@": STRING
    issn:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    publisher:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    url:
      =:
        - - 10
          - 4
        - {}
      "@": SchemaWrapper
    homepage:
      =:
        - - 10
          - 4
        - {}
      "@": SchemaWrapper
    xid:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    description:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    source_url:
      =:
        - - 10
          - 4
        - {}
      "@": SchemaWrapper
    created_at:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    updated_at:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    indexed_at:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    indexed_full:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    published_at:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    papers_all:
      =:
        - - 10
          - 3
        - {}
      "@": SchemaWrapper
    papers_published:
      =:
        - - 10
          - 3
        - {}
      "@": SchemaWrapper
    "@": Catalog
  __category__:
    "@":
      - 0
      - 0
  "@": Data
- __id:
    - 0
    - 202
  name: Paper
  info: Paperity's Paper object.
  fields:
    pid:
      =:
        - - 10
          - 3
        - {}
      "@": SchemaWrapper
    title:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    authors:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    url:
      =:
        - - 10
          - 4
        - {}
      "@": SchemaWrapper
    homepage:
      =:
        - - 10
          - 4
        - {}
      "@": SchemaWrapper
    abstract:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    journal_id:
      =:
        - - 10
          - 2
        - {}
      "@": SchemaWrapper
    date:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    birth:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    year:
      =:
        - - 10
          - 2
        - {}
      "@": SchemaWrapper
    languages:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    created_at:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    updated_at:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    harvested_at:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    extracted_at:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    published_at:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    doi:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    url_pdf:
      =:
        - - 10
          - 4
        - {}
      "@": SchemaWrapper
    pdf_name:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    rawtext:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    source_url:
      =:
        - - 10
          - 4
        - {}
      "@": SchemaWrapper
    pic_original_name:
      =:
        - - 10
          - 1
        - {}
      "@": SchemaWrapper
    "@": Catalog
  class_init: |-
    import { H1, H4, DIV, A, P, BR, SPAN, FRAGMENT, BLOCKQUOTE } 
    from '/system/local/react-utils.js'
  handlers:
    view: >+
      view() {
          let paper = this.object()
          return (
              DIV({className: "container"}, 
              DIV({className: "row"},
              DIV({className: "col col-sm-9 col-xs-12 custom-col-lg-9"},
              DIV({className: "panel panel-body panel-content bg-white"},
                  H1(paper.title),
          )))))
      }


      assets() {
          return `
          <script src="https://paperity.org/static/js/dc9afabe2e.js"></script>
          <script src="https://paperity.org/static/js/jquery-1.11.1.min.js"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.devbridge-autocomplete/1.2.26/jquery.autocomplete.min.js"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.textcomplete/1.7.3/jquery.textcomplete.js"></script>
          
          <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
          <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
          
          <link href="https://paperity.org/static/css/paperity.css" rel="stylesheet">
          <script src="https://paperity.org/static/js/paperity.js"></script>
          
          <style>body {width: revert; padding: 10px;}</style>
          `
      }

    view__draft: >-
      view() {
          let paper = this.object()
          return P({dangerouslySetInnerHTML: {__html: `
      <div class="panel panel-body panel-content bg-white" style="height: auto !important;">
          <h1>${paper.title}</h1>
          <p class="text-muted">
              <a class="bib-journal" href="___JOURNAL_URL___">___JOURNAL-TITLE___</a>,
              ___MONTH-YEAR___
          </p>

          <div class="row">
              <div class="col-lg-3 col-md-3 col-xs-12">
                  <p class="hidden-md hidden-lg author-names" style="margin-top:0"><a
                          href="/search/?q=authors%3A%22Takehiko+Yogo%22">___AUTHOR-1___</a></p>
                  <div class="hidden-xs hidden-sm lead author-names text-right">
                      <a href="/search/?q=authors%3A%22Takehiko+Yogo%22">___AUTHOR-1___</a>
                  </div>
              </div>
              <div class="col-lg-9 col-md-9 col-xs-12">
                  <blockquote>${paper.abstract}</blockquote>
              </div>
          </div>

          <div class="row">
              <div class="col-xs-6"></div>
              <div class="col-xs-6 text-right">
                  <button title="Copy full text to clipboard" id="copy-button" class="btn btn-sm btn-default"
                          onclick="alertFlash();">
                      <span class="glyphicon glyphicon-edit"></span>
                  </button>
                  <button title="Full screen" class="btn btn-sm btn-default" data-toggle="modal"
                          data-target="#full-screen-viewer">
                      <span class="glyphicon glyphicon-fullscreen"></span>
                  </button>
              </div>
          </div>


          <div class="pdf-viewer" id="pdf-viewer">
              <object data="https://digitalcommons.uri.edu/cgi/viewcontent.cgi?article=1090&amp;context=mgdr#toolbar=1&amp;navpanes=0&amp;messages=0&amp;page=1&amp;zoom=page-width&amp;view=FitH"
                      type="application/pdf" style="margin-bottom:-10px" alt="Please wait" id="fulltext-viewer" width="100%"
                      height="100%">
                  <div class="well">

                      <div class="alert bg-red">
                          <p> A PDF file should load here. If you do not see its contents
                              the file may be temporarily unavailable at the journal website
                              or you do not have a PDF plug-in installed and enabled in your browser.
                          </p>
                          <p> Alternatively, you can download the file locally and open with any standalone PDF reader: </p>
                          <p><a href="${paper.url_pdf}" rel="nofollow">${paper.url_pdf}</a></p>
                      </div>
                      <div id="rawtext" class="">
                          <h4>${paper.title}</h4>
                          <div class="pre-wrap">${paper.rawtext}</div>
                      </div>
                  </div>
              </object>
          </div>

          <div class="modal fade" id="full-screen-viewer">
              <div class="modal-dialog modal-full">
                  <div class="modal-content modal-full pdf-viewer-full">
                      <div class="pull-right">
                          <a href="javascript:closeFullScreenViewer();" class=""><span
                                  class="pdf-viewer-full-close glyphicon glyphicon-remove"> </span></a>
                      </div>
                      <div class="modal-body modal-full" id="pdf-viewer-full" style="padding-bottom:0; padding-left:0">
                          <div id="full-screen-viewer-object"></div>
                      </div>
                  </div>
              </div>
          </div>

          <p class="endnote">
              <br>
              This is a preview of a remote PDF: <a
                  href="${paper.url_pdf}"
                  rel="nofollow noopener" target="_blank">${paper.url_pdf}</a>
          </p>
          <p class="endnote">
              ___AUTHOR-1-3___. <i>${paper.title}</i>, ___JOURNAL-TITLE___, ${paper.year}, ___VOLUME___, ___ISSUE___,
          </p>

      </div>
          `}})
      }
    "@": Catalog
  __category__:
    "@":
      - 0
      - 0
  "@": Data
