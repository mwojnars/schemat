<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home | The Bookstore</title>
    <link rel="stylesheet" href="/common/styles.css">
</head>
<body>
    <%
        function select_random(array, count) {
            /* Randomly select `count` elements from `array`. */
            return array.sort(() => Math.random() - 0.5).slice(0, count)
        }

        let authors = await schemat.global.AuthorCategory.list_objects({load: true})
        let books = await schemat.global.BookCategory.list_objects({load: true})

        let featured_authors = select_random(authors, 6)
        let featured_books = select_random(books, 6)

        for (let book of featured_books)
            for (let author of book.author$) await author.load()
    %>
    <%-
        // The instruction below makes Schemat runtime (`schemat`) available on client, in case we need it.
        // IMPORTANT: its output must be embedded here as a non-escaped EJS block!
        schemat.init_client()
    %>
    <header>
        <h1>Welcome to The Bookstore!</h1>
        <nav>
            <a href="/">Home</a>
            <a href="/books">Books</a>
            <a href="/authors">Authors</a>
            <a href="/common/about.html">About</a>
        </nav>
    </header>
    <main>
        <section id="featured-books">
            <h2>Featured Books</h2>
            <div class="preview-container">
                <% featured_books.forEach(book => { %>
                    <div class="book-preview">
                        <h3><a href="/book/<%= book.id %>"><%= book.title %></a></h3>
                        <img src="<%= book.cover_image %>" alt="<%= book.title %> cover" class="book-cover">
                        <p>by <%= book.author.name %></p>
                        <p>Rating: <%= book.average_rating %>/5</p>
                        <a href="/book/<%= book.id %>">View Details</a>
                    </div>
                <% }) %>
            </div>
            <a href="/books" class="view-all">View All Books</a>
        </section>
        <section id="featured-authors">
            <h2>Featured Authors</h2>
            <div class="preview-container">
                <% featured_authors.forEach(author => { %>
                    <div class="author-preview">
                        <h3><a href="/authors#<%= author.id %>"><%= author.name %></a></h3>
                        <p>Notable work: <%= author.notable_work %></p>
                        <p><%= author.nationality %>, <%= author.birth_year %> - <%= author.death_year || 'Present' %></p>
                        <a href="/authors#<%= author.id %>">View Profile</a>
                    </div>
                <% }) %>
            </div>
            <a href="/authors" class="view-all">View All Authors</a>
        </section>
    </main>
    <footer>
        <p>&copy; 2024 The Bookstore. All rights reserved.</p>
    </footer>
</body>
</html>